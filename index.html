<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AGROAI - Akıllı Tarım Teknolojileri</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;500;700&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Roboto', sans-serif; background-color: #f0f2f5; }
        h1, h2, h3, h4, .brand-font, button { font-family: 'Oswald', sans-serif; text-transform: uppercase; }
        
        /* Kart Tasarımı */
        .sharp-card {
            border-radius: 0px;
            background: white;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border: 1px solid #d1d5db;
        }

        /* Yükleme Dişlisi */
        .gear-loader { animation: spin-gear 3s infinite linear; color: #ea580c; }
        @keyframes spin-gear { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Buton Efekti */
        .industrial-btn { border-bottom: 4px solid #9a3412; transition: all 0.1s; }
        .industrial-btn:active { border-bottom: 0px solid #9a3412; transform: translateY(4px); }

        /* Video Kartı */
        .video-card { background: #fff; border-left: 6px solid #ea580c; transition: all 0.3s ease; }
        .video-card:hover { background: #fff7ed; transform: translateX(5px); }
        
        /* Tıklanabilirlik Düzeltmesi */
        .pointer-events-none { pointer-events: none; }
    </style>
</head>

<body class="text-gray-800 antialiased">

    <header class="bg-gray-900 text-white shadow-xl sticky top-0 z-50 border-b-4 border-orange-600">
        <div class="container mx-auto px-4 h-20 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="w-12 h-12 bg-orange-600 flex items-center justify-center font-bold text-3xl skew-x-[-12deg] shadow-lg">
                    <span class="skew-x-[12deg] text-white">A</span>
                </div>
                <div>
                    <h1 class="text-3xl font-bold tracking-wider leading-none">AGRO<span class="text-orange-500">AI</span></h1>
                    <p class="text-[10px] text-gray-400 tracking-[0.3em]">INTELLIGENT CROP PROTECTION</p>
                </div>
            </div>
        </div>
    </header>

    <div class="bg-gray-800 text-white py-12 relative overflow-hidden border-b border-gray-700">
        <div class="absolute inset-0 opacity-10 bg-[url('https://images.unsplash.com/photo-1625246333195-78d9c38ad449?q=80&w=2070&auto=format&fit=crop')] bg-cover bg-center grayscale"></div>
        <div class="container mx-auto px-4 relative z-10">
            <div class="inline-block bg-orange-600 text-white text-xs font-bold px-2 py-1 mb-3 skew-x-[-10deg]">V2.1 STABLE</div>
            <h2 class="text-4xl md:text-5xl font-bold mb-2 tracking-tight">AKILLI TESPİT SİSTEMİ</h2>
            <p class="text-gray-400 text-lg max-w-xl font-light font-roboto">Endüstriyel görüntü işleme teknolojisi.</p>
        </div>
    </div>

    <div class="container mx-auto px-4 py-8 max-w-7xl -mt-8 relative z-20">
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-6 items-start">
            
            <div class="lg:col-span-4 space-y-5">
                
                <div class="sharp-card p-0 overflow-hidden bg-white">
                    <div class="bg-gray-100 p-4 border-b border-gray-300 flex justify-between items-center">
                        <h3 class="text-gray-800 font-bold flex items-center gap-2 text-lg">
                            <i class="fa-solid fa-satellite-dish text-orange-600"></i> SENSÖR GİRİŞİ
                        </h3>
                        <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                    </div>
                    
                    <div class="p-6 bg-gray-50">
                        <label class="block relative w-full aspect-square cursor-pointer bg-white border-2 border-dashed border-gray-400 hover:border-orange-500 transition-all group shadow-inner">
                            <div id="uploadPlaceholder" class="absolute inset-0 flex flex-col items-center justify-center text-center p-6 pointer-events-none">
                                <i class="fa-solid fa-camera text-5xl text-gray-300 group-hover:text-orange-500 transition duration-300 transform group-hover:scale-110"></i>
                                <span class="font-bold text-gray-700 mt-4 text-xl tracking-wide">FOTOĞRAF YÜKLE</span>
                                <span class="text-xs text-gray-400 mt-2 font-roboto">Tıklayın veya sürükleyin</span>
                            </div>
                            <img id="imagePreview" class="hidden w-full h-full object-cover pointer-events-none" />
                            <input id="imageUpload" type="file" class="hidden" accept="image/*" />
                        </label>
                        <button id="removeImageBtn" class="hidden w-full mt-2 bg-red-600 text-white py-2 text-sm font-bold hover:bg-red-700 shadow-md">
                            GÖRÜNTÜYÜ TEMİZLE
                        </button>
                    </div>
                </div>

                <div class="sharp-card p-5 bg-white">
                    <h3 class="text-gray-700 font-bold mb-2 text-sm">EK PARAMETRELER</h3>
                    <textarea id="prompt" rows="2" class="w-full bg-gray-50 border border-gray-300 p-3 text-sm focus:border-orange-500 focus:ring-0 outline-none resize-none" placeholder="Bitkideki belirtiler..."></textarea>
                </div>

                <button id="analyzeButton" class="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold text-2xl py-6 shadow-xl industrial-btn flex items-center justify-center gap-4 group">
                    <span>SİSTEMİ BAŞLAT</span>
                    <i class="fa-solid fa-power-off group-hover:animate-pulse"></i>
                </button>
            </div>


            <div class="lg:col-span-8">
                
                <div id="emptyState" class="sharp-card p-12 text-center h-[600px] flex flex-col items-center justify-center bg-white border-2 border-dashed border-gray-300">
                    <i class="fa-solid fa-microchip text-7xl text-gray-200 mb-6"></i>
                    <h3 class="text-3xl font-bold text-gray-800 tracking-wide">BEKLEME MODU</h3>
                    <p class="text-gray-500 mt-3 font-light font-roboto">Görüntü girişi bekleniyor...</p>
                </div>

                <div id="loadingState" class="hidden sharp-card p-12 text-center h-[600px] flex flex-col items-center justify-center bg-white">
                    <i class="fa-solid fa-gear text-7xl gear-loader mb-8"></i>
                    <h3 class="text-3xl font-bold text-gray-800 tracking-widest">VERİ İŞLENİYOR</h3>
                    <p class="text-gray-500 mt-2 font-mono text-sm">AI MOTORU ÇALIŞIYOR...</p>
                    <div class="w-64 h-2 bg-gray-200 mt-8 rounded-full overflow-hidden">
                        <div class="h-full bg-orange-600 animate-[loading_2s_ease-in-out_infinite]"></div>
                    </div>
                </div>

                <div id="errorState" class="hidden bg-red-100 border-l-8 border-red-600 p-8 shadow-sm mb-6">
                    <h3 class="text-2xl font-bold text-red-800 flex items-center gap-3">
                        <i class="fa-solid fa-triangle-exclamation"></i> SİSTEM HATASI
                    </h3>
                    <p id="errorMessage" class="text-red-700 mt-2 font-mono">Sunucu bağlantısı kurulamadı.</p>
                </div>

                <div id="resultContainer" class="hidden space-y-6">
                    </div>

            </div>
        </div>
    </div>

    <script>
        const imageUpload = document.getElementById('imageUpload');
        const imagePreview = document.getElementById('imagePreview');
        const uploadPlaceholder = document.getElementById('uploadPlaceholder');
        const removeImageBtn = document.getElementById('removeImageBtn');
        const promptInput = document.getElementById('prompt');
        const analyzeButton = document.getElementById('analyzeButton');
        const emptyState = document.getElementById('emptyState');
        const loadingState = document.getElementById('loadingState');
        const errorState = document.getElementById('errorState');
        const resultContainer = document.getElementById('resultContainer');
        const errorMessage = document.getElementById('errorMessage');

        let base64ImageData = null;

        // Fotoğraf Yükleme
        imageUpload.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    base64ImageData = e.target.result.split(',')[1];
                    imagePreview.src = e.target.result;
                    imagePreview.classList.remove('hidden');
                    uploadPlaceholder.classList.add('hidden');
                    removeImageBtn.classList.remove('hidden');
                };
                reader.readAsDataURL(file);
            }
        });

        // Temizleme
        removeImageBtn.addEventListener('click', (e) => {
            e.preventDefault();
            e.stopPropagation();
            imageUpload.value = '';
            base64ImageData = null;
            imagePreview.classList.add('hidden');
            imagePreview.src = '';
            uploadPlaceholder.classList.remove('hidden');
            removeImageBtn.classList.add('hidden');
        });

        // SYSTEM PROMPT (DÜZELTİLDİ: GARANTİLİ VİDEO LİNKLERİ)
        const systemPrompt = `
        Sen "AgroAI" adında, endüstriyel tarım teknolojileri uzmanı bir yapay zekasın.
        
        GÖREV:
        1. Kullanıcının bitki fotoğrafını veya sorusunu analiz et.
        2. Teşhis, Mücadele Yöntemleri ve Bakım önerileri sun.
        3. YouTube videoları için DOĞRUDAN arama linkleri oluştur. (Asla video ID uydurma).
        
        VİDEO LİNK FORMATI (Bunu kesinlikle uygula):
        Linkleri şu formatta oluştur: https://www.youtube.com/results?search_query=[BITKI_ADI]+[HASTALIK_ADI]+cozumu
        (Örn: https://www.youtube.com/results?search_query=domates+mildiyo+ilaci)
        
        ÇIKTI FORMATI:
        Aşağıdaki HTML şablonunu kullan. Asla Markdown kullanma.

        <div class="sharp-card p-8 border-t-8 border-orange-600 bg-white">
            <h2 class="text-4xl font-bold text-gray-900 uppercase">[BİTKİ ADI]</h2>
            <h3 class="text-2xl text-orange-600 font-bold uppercase mt-1">[TESPİT EDİLEN SORUN]</h3>
            <div class="mt-6 bg-gray-50 border-l-4 border-gray-400 p-6 text-gray-700 text-lg">
                [ANALİZ DETAYLARI]
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="sharp-card p-6 bg-white border-l-4 border-orange-500">
                <h4 class="font-bold text-gray-800 mb-4 flex items-center gap-2"><i class="fa-solid fa-flask text-orange-600"></i> MÜCADELE</h4>
                <ul class="space-y-2 text-gray-700">
                    <li>[MÜCADELE YÖNTEMİ 1]</li>
                    <li>[MÜCADELE YÖNTEMİ 2]</li>
                </ul>
            </div>
            <div class="sharp-card p-6 bg-white border-l-4 border-green-700">
                <h4 class="font-bold text-gray-800 mb-4 flex items-center gap-2"><i class="fa-solid fa-tractor text-green-700"></i> KÜLTÜREL ÖNLEMLER</h4>
                <ul class="space-y-2 text-gray-700">
                    <li>[ÖNLEM 1]</li>
                    <li>[ÖNLEM 2]</li>
                </ul>
            </div>
        </div>

        <div class="space-y-4">
             <h4 class="font-bold text-gray-800 text-lg uppercase flex items-center gap-2">
                <i class="fa-solid fa-video text-red-600"></i> EĞİTİM VİDEOLARI (YOUTUBE ARAMA)
             </h4>
             
             <a href="https://www.youtube.com/results?search_query=[ARAMA_TERIMI_1]" target="_blank" class="video-card block p-6 flex items-center justify-between group shadow-sm">
                <div class="flex items-center gap-5">
                    <div class="w-12 h-12 bg-red-600 text-white flex items-center justify-center font-bold text-2xl rounded-sm">
                        <i class="fa-brands fa-youtube"></i>
                    </div>
                    <div>
                        <div class="font-bold text-xl text-gray-900 group-hover:text-orange-600 transition uppercase">[VİDEO KONU BAŞLIĞI 1]</div>
                        <div class="text-sm text-gray-500">İlgili Videoları Listele</div>
                    </div>
                </div>
                <i class="fa-solid fa-external-link text-gray-400"></i>
             </a>
             
             <a href="https://www.youtube.com/results?search_query=[ARAMA_TERIMI_2]" target="_blank" class="video-card block p-6 flex items-center justify-between group shadow-sm">
                <div class="flex items-center gap-5">
                    <div class="w-12 h-12 bg-red-600 text-white flex items-center justify-center font-bold text-2xl rounded-sm">
                        <i class="fa-brands fa-youtube"></i>
                    </div>
                    <div>
                        <div class="font-bold text-xl text-gray-900 group-hover:text-orange-600 transition uppercase">[VİDEO KONU BAŞLIĞI 2]</div>
                        <div class="text-sm text-gray-500">İlgili Videoları Listele</div>
                    </div>
                </div>
                <i class="fa-solid fa-external-link text-gray-400"></i>
             </a>
        </div>
        `;

        analyzeButton.addEventListener('click', async () => {
            const userText = promptInput.value;

            if (!userText && !base64ImageData) {
                alert("LÜTFEN ÖNCE BİR GÖRÜNTÜ YÜKLEYİNİZ.");
                return;
            }

            analyzeButton.disabled = true;
            analyzeButton.innerHTML = '<i class="fa-solid fa-gear fa-spin"></i> İŞLENİYOR...';
            analyzeButton.classList.add('bg-gray-600', 'cursor-not-allowed');
            analyzeButton.classList.remove('bg-orange-600', 'hover:bg-orange-700');

            emptyState.classList.add('hidden');
            resultContainer.classList.add('hidden');
            errorState.classList.add('hidden');
            loadingState.classList.remove('hidden');

            try {
                let fullPrompt = systemPrompt;
                if(userText) fullPrompt += "\n\nEK NOT: " + userText;

                const response = await fetch('/api/analyze', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        prompt: fullPrompt,
                        image: base64ImageData,
                        mimeType: "image/jpeg"
                    })
                });

                const data = await response.json();

                if (!response.ok) throw new Error(data.error || "Hata");

                resultContainer.innerHTML = data.result;
                loadingState.classList.add('hidden');
                resultContainer.classList.remove('hidden');
                
                if(window.innerWidth < 1024) {
                    resultContainer.scrollIntoView({ behavior: 'smooth' });
                }

            } catch (error) {
                console.error(error);
                loadingState.classList.add('hidden');
                errorState.classList.remove('hidden');
                errorMessage.textContent = error.message || "Bağlantı hatası.";
            } finally {
                analyzeButton.disabled = false;
                analyzeButton.innerHTML = '<span>SİSTEMİ BAŞLAT</span><i class="fa-solid fa-power-off"></i>';
                analyzeButton.classList.remove('bg-gray-600', 'cursor-not-allowed');
                analyzeButton.classList.add('bg-orange-600', 'hover:bg-orange-700');
            }
        });
    </script>
</body>
</html>
